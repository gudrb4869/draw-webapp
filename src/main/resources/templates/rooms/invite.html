<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<body class="d-flex flex-column min-vh-100">
<div th:replace="fragments/bodyheader" :: bodyheader />
<div class="container">
    <div class="py-5 text-center">
        <h2>멤버 초대</h2>
    </div>
    <div class="row justify-content-center">
        <form class="col-sm-6 mx-auto" th:action th:object="${inviteForm}" method="post">

            <div th:if="${#fields.hasGlobalErrors()}">
                <p class="text-danger" th:each="err : ${#fields.globalErrors()}" th:text="${err}">전체 오류 메시지</p>
            </div>

            <div class="mb-3">
                <label th:for="count">초대 인원수</label>
                <select th:field="*{count}" class="form-select" th:errorclass="border-danger" onchange="updateForm()">
                    <option th:each="count : ${#numbers.sequence(1, 100)}" th:value="${count}" th:text="${count}"
                            th:selected="${count} == ${inviteForm.count}"></option>
                </select>
                <p th:errors="*{count}" class="text-danger">인원수 오류</p>
            </div>

            <table class="table table-hover">
                <thead>
                <tr>
                    <th>번호</th>
                    <th>아이디</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="email : *{emails}">
                    <td th:text="${emailStat.count}"></td>
                    <td>
                        <input type="text" th:field="*{emails[__${emailStat.index}__]}"
                               th:errorclass="is-invalid" class="form-control"/>
                        <p th:errors="*{emails[__${emailStat.index}__]}" class="text-danger">이메일 형식이 올바르지 않음</p>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="row">
                <div class="col">
                    <button type="submit" class="btn btn-primary btn-lg">초대</button>
                    <button type="button" class="btn btn-warning btn-lg" th:onclick="|location.href='@{|/rooms/${roomId}|}'|">취소</button>
                </div>
            </div>
        </form>
        <div class="mb-4"></div>
    </div>
</div> <!-- /container -->
<div th:replace="fragments/footer" :: footer />
</body>
<script>
    const add_textbox = () => {
        const box = document.getElementById("box");
        const newP = document.createElement('p');
        newP.innerHTML = "<input type='text'> <input type='button' value='삭제' onclick='remove(this)'>";
        box.appendChild(newP);
    }
    const remove = (obj) => {
        document.getElementById('box').removeChild(obj.parentNode);
    }
</script>
<script th:inline="javascript">
    history.replaceState({}, null, location.pathname);
    function updateForm() {
        let roomId = [[${roomId}]];
        let count = document.getElementById("count").value;
        let emails = []
        for (var i = 0; i < count; i++) {
            if (document.getElementById("emails" + String(i))) {
                emails.push(document.getElementById("emails" + String(i)).value)
            }
            else {
                emails.push("")
            }
        }
        location.href="/rooms/" + roomId + "/invite?count=" + count + "&emails=" + emails;
    }
</script>
</html>