<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<style>
    .field-error {
        border-color: #dc3545;
        color: #dc3545;
    }
    .form-center {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .form-width {
        max-width: 600px;
    }
</style>
<body>
<div>
    <div th:replace="fragments/bodyheader" :: bodyheader />
    <div class="py-5 text-center">
        <h2>멤버 초대</h2>
    </div>
    <div class="form-center">
        <form class="form-control form-width" th:action th:object="${inviteForm}" method="post">

            <div th:if="${#fields.hasGlobalErrors()}">
                <p class="field-error" th:each="err : ${#fields.globalErrors()}" th:text="${err}">전체 오류 메시지</p>
            </div>

            <div class="py-2">
                <div>초대 인원 수</div>
                <select th:field="*{count}" class="form-select-sm" onchange="updateForm()">
                    <option th:each="count : ${#numbers.sequence(1, 100)}" th:value="${count}" th:text="${count}"
                            th:selected="${count} == ${inviteForm.count}"></option>
                </select>
            </div>

            <div>
                <table class="table">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>아이디</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="email : *{emails}">
                        <td th:text="${emailStat.count}"></td>
                        <td>
                            <input type="text" th:field="*{emails[__${emailStat.index}__]}"
                                   th:errorclass="field-error" class="form-control"/>
                            <p th:errors="*{emails[__${emailStat.index}__]}" class="field-error">이메일 형식이 올바르지 않음</p>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="row">
                <div class="col">
                    <button type="submit" class="btn btn-primary btn-lg">초대</button>
                    <a th:href="@{|/rooms/${roomId}|}" class="btn btn-warning btn-lg">취소</a>
                </div>
            </div>

        </form>
    </div>
    <div th:replace="fragments/footer" :: footer />
</div> <!-- /container -->
</body>

<script th:inline="javascript">
    history.replaceState({}, null, location.pathname);
    function updateForm() {
        let roomId = [[${roomId}]];
        let count = document.getElementById("count").value;
        let emails = []
        for (var i = 0; i < count; i++) {
            if (document.getElementById("emails" + String(i))) {
                emails.push(document.getElementById("emails" + String(i)).value)
            }
            else {
                emails.push("")
            }
        }
        location.href="/rooms/" + roomId + "/invite?count=" + count + "&emails=" + emails;
    }
</script>
</html>