<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<style>
    .table-center {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .table-width {
        max-width: 1000px;
    }
    ul {
        list-style: none;
    }
    li {
        float: left;
        margin-left: 20px;
    }
</style>
<body>
<div>
    <div th:replace="fragments/bodyheader" :: bodyheader />
    <hr class="my-4">
    <div class="table-center">
        <table class="table table-striped text-center table-width">
            <thead>
            <tr>
                <th>방 이름</th>
                <th>방 공개여부</th>
                <th>방 인원</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td th:text="${room.title}"></td>
                <td th:text="${room.roomSetting.description}"></td>
                <td th:text="${belongList.getTotalElements()}"></td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="">
        <a th:href="@{/rooms}" class="btn btn-warning">목록</a>
        <a class="btn btn-primary my-2 my-sm-0" th:if="${myBelong ne null and (myBelong.belongType.name() ne 'USER')}"
           th:href="@{/rooms/{roomId}/invite(roomId = ${room.id})}">초대</a>
        <a class="btn btn-secondary my-2 my-sm-0" th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}"
           th:href="@{|/rooms/${roomId}/edit|}">수정</a>
        <form class="form-check-inline my-2 my-lg-0" th:action="@{|/rooms/${room.id}|}" method="post">
            <input type="hidden" th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}" name="_method" value="delete"/>
            <button class="btn btn-danger my-2 my-sm-0" type="submit"
                    th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}">삭제</button>
        </form>
        <a class="btn btn-info" th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}"
           th:href="@{|/rooms/${roomId}/competitions/create|}" role="button" style="float:right;">대회 만들기</a>
    </div>

    <hr class="my-4">

    <div class="py-2 text-center">
        <h1>참여자 목록</h1>
    </div>

    <hr class="my-4">

    <div class="table-center">
        <table class="table table-light text-center table-width">
            <thead>
            <tr>
                <th>이름</th>
                <th>권한</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="belong : ${belongList}">
                <td th:text="${belong.member.email + '('+ belong.member.name + ')'}"></td>
                <td th:text="${belong.belongType.description}"></td>
            </tr>
            </tbody>
        </table>
    </div>
    <nav style="text-align: center;">
        <ul class="pagination"
            th:with="start=${T(java.lang.Math).floor(belongList.number/10)*10 + 1},
                    last=(${start + 9 < belongList.totalPages ? start + 9 : belongList.totalPages})">
            <li>
                <a th:href="@{|/rooms/${roomId}|(belong_page=1, competition_page=${competitionList.number + 1})}" aria-label="First">
                    <span aria-hidden="true"><<</span>
                </a>
            </li>

            <li th:class="${belongList.first} ? 'disabled'">
                <a th:href="${belongList.first} ? '#' :@{|/rooms/${roomId}|(belong_page=${belongList.number}, competition_page=${competitionList.number + 1})}" aria-label="Previous">
                    <span aria-hidden="true">&lt;</span>
                </a>
            </li>

            <li th:each="page: ${#numbers.sequence(start, last, 1)}" th:class="${page == belongList.number + 1} ? 'active'">
                <a th:text="${page}" th:href="@{|/rooms/${roomId}|(belong_page=${page}, competition_page=${competitionList.number + 1})}"></a>
            </li>

            <li th:class="${belongList.last} ? 'disabled'">
                <a th:href="${belongList.last} ? '#' : @{|/rooms/${roomId}|(belong_page=${belongList.number + 2}, competition_page=${competitionList.number + 1})}" aria-label="Next">
                    <span aria-hidden="true">&gt;</span>
                </a>
            </li>

            <li>
                <a th:href="@{|/rooms/${roomId}|(belong_page=${belongList.totalPages}, competition_page=${competitionList.number + 1})}" aria-label="Last">
                    <span aria-hidden="true">>></span>
                </a>
            </li>
        </ul>
    </nav>

    <hr class="my-4">

    <div class="py-2 text-center">
        <h1>대회 목록</h1>
    </div>
    <div class="table-center">
        <table class="table table-width text-center">
            <thead>
            <tr>
                <th>대회명</th>
                <th>대회방식</th>
                <th>참여자수</th>
                <th>대회생성일</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${competitionList.isEmpty()}">
                <td class="text-center" colspan="5">참여중인 대회가 없습니다!</td>
            </tr>
            <tr th:each="competition : ${competitionList}">
                <td th:text="${competition.title}">test</td>
                <td th:text="${competition.competitionType.description}">리그</td>
                <td th:text="|명|">0명</td>
                <td th:text="${#temporals.format(competition.createdDate, 'yyyy-MM-dd HH:mm:ss')}">날짜</td>
                <td>
                    <div>
                        <form class="form-check-inline my-2 my-lg-0" th:action="@{|/rooms/${room.id}/competitions/${competition.id}|}" method="post">
                            <a class="btn btn-primary my-2 my-sm-0" th:href="@{|/rooms/${room.id}/competitions/${competition.id}|}">조회</a>
                            <input type="hidden" name="_method" value="delete"
                                   th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}"/>
                            <button class="btn btn-danger my-2 my-sm-0" type="submit"
                                    th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}">삭제</button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <nav style="text-align: center;">
        <ul class="pagination"
            th:with="start=${T(java.lang.Math).floor(competitionList.number/10)*10 + 1},
                    last=(${start + 9 < competitionList.totalPages ? start + 9 : competitionList.totalPages})">
            <li>
                <a th:href="@{|/rooms/${roomId}|(belong_page=${belongList.number + 1}, competition_page=1)}" aria-label="First">
                    <span aria-hidden="true"><<</span>
                </a>
            </li>

            <li th:class="${competitionList.first} ? 'disabled'">
                <a th:href="${competitionList.first} ? '#' :@{|/rooms/${roomId}|(belong_page=${belongList.number + 1}, competition_page=${competitionList.number})}" aria-label="Previous">
                    <span aria-hidden="true">&lt;</span>
                </a>
            </li>

            <li th:each="page: ${#numbers.sequence(start, last, 1)}" th:class="${page == competitionList.number + 1} ? 'active'">
                <a th:text="${page}" th:href="@{|/rooms/${roomId}|(belong_page=${belongList.number + 1}, competition_page=${page})}"></a>
            </li>

            <li th:class="${competitionList.last} ? 'disabled'">
                <a th:href="${competitionList.last} ? '#' : @{|/rooms/${roomId}|(belong_page=${belongList.number + 1}, competition_page=${competitionList.number + 2})}" aria-label="Next">
                    <span aria-hidden="true">&gt;</span>
                </a>
            </li>

            <li>
                <a th:href="@{|/rooms/${roomId}|(belong_page=${belongList.number + 1}, competition_page=${competitionList.totalPages})}" aria-label="Last">
                    <span aria-hidden="true">>></span>
                </a>
            </li>
        </ul>
    </nav>
    <div th:replace="fragments/footer" :: footer />
</div> <!-- /container -->
</body>
</html>