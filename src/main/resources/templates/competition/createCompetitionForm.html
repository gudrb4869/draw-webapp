<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<body class="d-flex flex-column min-vh-100">
<div th:replace="fragments/bodyheader" :: bodyheader />
<div class="container">
    <div class="py-5 text-center">
        <h2>대회 만들기</h2>
    </div>
    <div class="row mx-auto justify-content-center">
        <form class="col-md-6 mx-auto" th:action th:object="${form}" method="post">
            <div th:if="${#fields.hasGlobalErrors()}">
                <p class="text-danger" th:each="err : ${#fields.globalErrors()}" th:text="${err}">전체 오류 메시지</p>
            </div>
            <div class="mb-3">
                <label th:for="name">대회명</label>
                <input type="text" th:field="*{name}" placeholder="대회명을 입력하세요"
                       class="form-control" th:errorclass="is-invalid" autofocus="autofocus">
                <p th:errors="*{name}" class="text-danger">대회명 오류</p>
            </div>

            <div class="mb-3">
                <label th:for="type">대회 방식</label>
                <div th:each="type : ${T(hongik.ce.jolup.domain.competition.CompetitionType).values()}" class="form-check">
                    <input type="radio" th:field="*{type}" th:value="${type.name()}" class="form-check-input" onclick="updateCount(this.value)">
                    <label th:for="${#ids.prev('type')}" th:text="${type.description}" class="form-check-label"></label>
                </div>
                <p th:errors="*{type}" class="text-danger">대회방식 오류</p>
            </div>

            <div class="mb-3">
                <div class="fw-bold mb-1">옵션</div>
                <div th:each="option : ${T(hongik.ce.jolup.domain.competition.CompetitionOption).values()}" class="form-check form-check-inline">
                    <input type="radio" th:field="*{option}" th:value="${option.name()}" class="form-check-input">
                    <label th:for="${#ids.prev('option')}" th:text="${option.description}" class="form-check-label"></label>
                </div>
                <p th:errors="*{option}" class="text-danger">대회방식 오류</p>
            </div>

            <div class="mb-3">
                <label th:for="count">참가자수</label>
                <select th:field="*{count}" class="form-select" th:errorclass="border-danger" onchange="updateForm()">
                    <option value="">==참가자수 선택==</option>
                    <option th:each="count : ${#numbers.sequence(2, 24)}" th:value="${count}" th:text="${count}"></option>
                </select>
                <p th:errors="*{count}" class="text-danger">참가자수 오류</p>
            </div>
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>번호</th>
                    <th>아이디</th>
                </tr>
                </thead>
                <tbody id="emails" name="emails">
                <tr th:each="email : *{emails}">
                    <td th:text="${emailStat.count}"></td>
                    <td>
                        <input type="text" th:field="*{emails[__${emailStat.index}__]}"
                               th:errorclass="is-invalid" class="form-control"/>
                        <p th:errors="*{emails[__${emailStat.index}__]}" class="text-danger">이메일 형식이 올바르지 않음</p>
                    </td>
                </tr>
                </tbody>
            </table>
            <div class="row">
                <div class="col">
                    <button type="submit" class="btn btn-default">생성</button>
                    <button type="button" class="btn btn-default" th:onclick="|location.href='@{|/rooms/${roomId}|}'|">취소</button>
                </div>
            </div>
        </form>
        <div class="mb-4"></div>
    </div>
</div> <!-- /container -->
<div th:replace="fragments/footer" :: footer />
</body>
<script>
    let updateCount = (t) => {
        let count = document.getElementById("count");
        if (t == "LEAGUE") {
            for (let i = 64; i >= 25; i--) {
                count.lastElementChild.remove();
            }
        } else if (t == "TOURNAMENT") {
            for (let i = 25; i <= 64; i++) {
                const option = document.createElement('option')
                option.value = i
                option.innerHTML = i
                count.appendChild(option);
            }
        }
    }
</script>
<script th:inline="javascript">
    let updateForm = () => {
        let count = document.getElementById("count").value;
        let emails = document.getElementById("emails");
        let n = emails.childElementCount;
        if (count > n) {
            for (let i = n + 1; i <= count; i++) {
                const email = document.createElement('tr')
                email.innerHTML = "<tr><td>" + i + "</td>" +
                    "<td><input type='text' name='emails[" + (i - 1) + "]' class='form-control'/></td>" +
                    "</tr>";
                emails.appendChild(email);
            }
        }
        else {
            for (let i = n; i > count; i--) {
                emails.lastElementChild.remove();
            }
        }
    }
</script>
</html>