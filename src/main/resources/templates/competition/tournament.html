<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<style>
    .match {
        width: 100%;
        height: 60px;
        border: 2px solid black;
        margin: 10px 0;
    }

    .player {
        font-family:arial;
        overflow: hidden;
        /*text-overflow: ellipsis;*/
        white-space: nowrap;
        float: left;
        text-align: center;
    }

    .score {
        font-family:arial;
        float: right;
        text-align: center;
    }

    .round0 .match:first-child {
        margin-top: 5px;
    }
    .round0 .match {
        margin-top: 10px;
    }
    .round1 .match:first-child {
        margin-top: 40px;
    }
    .round1 .match {
        margin-top: 80px;
    }
    .round2 .match:first-child {
        margin-top: 110px;
    }
    .round2 .match {
        margin-top: 220px;
    }
    .round3 .match:first-child {
        margin-top: 250px;
    }
    .round3 .match {
        margin-top: 500px;
    }
    .round4 .match:first-child {
        margin-top: 530px;
    }
    .round4 .match {
        margin-top: 1060px;
    }
    .round5 .match:first-child {
        margin-top: 1090px;
    }

    .connector-area {
        width: 5%;
    }
    .connector {
    }
    .home {
        border: 2px solid black;
        border-left: none;
        border-bottom: none;
        height: 50px;
        width: 100%;
    }
    .away {
        border: 2px solid black;
        border-left: none;
        border-top: none;
        height: 50px;
        width: 100%;
    }
    .round1 .connector:first-child {
        margin-top: 36px;
    }
    .round1 .connector {
        margin-top: 70px;
    }
    .round1 .home {
        height: 35px;
    }
    .round1 .away {
        height: 35px;
    }
    .round2 .connector:first-child {
        margin-top: 69px;
    }
    .round2 .connector {
        margin-top: 136px;
    }
    .round2 .home {
        height: 72px;
    }
    .round2 .away {
        height: 72px;
    }
    .round3 .connector:first-child {
        margin-top: 139px;
    }
    .round3 .connector {
        margin-top: 276px;
    }
    .round3 .home {
        height: 142px;
    }
    .round3 .away {
        height: 142px;
    }
    .round4 .connector:first-child {
        margin-top: 279px;
    }
    .round4 .connector {
        margin-top: 556px;
    }
    .round4 .home {
        height: 282px;
    }
    .round4 .away{
        height: 282px;
    }
    .round5 .connector:first-child {
        margin-top: 559px;
    }
    .round5 .connector {
        margin-top: 1120px;
    }
    .round5 .home {
        height: 562px;
    }
    .round5 .away {
        height: 562px;
    }
    .line-area {
        width: 5%;
    }

    .line {
        border-top: 2px solid black;
    }
    .round1 .line:first-child {
        margin-top: 69px;
    }
    .round1 .line {
        margin-top: 138px;
    }
    .round2 .line:first-child {
        margin-top: 139px;
    }
    .round2 .line {
        margin-top: 278px;
    }
    .round3 .line:first-child {
        margin-top: 279px;
    }
    .round3 .line {
        margin-top: 558px;
    }
    .round4 .line:first-child {
        margin-top: 559px;
    }
    .round4 .line {
        margin-top: 1118px;
    }
    .round5 .line:first-child {
        margin-top: 1119px;
    }
</style>
<body class="d-flex flex-column min-vh-100 bg-light">
<div th:replace="fragments/bodyheader" :: bodyheader />
<div class="container">
    <div th:if="${message}" class="alert alert-info alert-dismissible show mt-3" role="alert">
        <span th:text="${message}">수정 완료</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <table class="table table-hover">
        <thead>
        <tr>
            <th class="col-4">대회명</th>
            <th class="col-4">대회방식</th>
<!--            <th class="col-4">참여자수</th>-->
        </tr>
        </thead>
        <tbody>
        <tr>
            <td class="col-4" th:text="${competition.getTitle}"></td>
            <td class="col-4" th:text="${competition.type.description}"></td>
<!--            <td class="col-4" th:text="${joins.size()}"></td>-->
        </tr>
        </tbody>
    </table>

    <div class="row">
        <div class="col">
            <button type="button" class="btn btn-outline-dark pull-right" th:onclick="|location.href='@{|/rooms/${roomId}|}'|">목록</button>
            <button type="button" class="btn btn-outline-dark pull-right" th:onclick="|location.href='@{|/rooms/${roomId}/competitions/${competitionId}/update|}'|"
                    th:if="${myJoin ne null and (myJoin.grade.name() eq 'ADMIN')}">수정</button>
            <form class="pull-right" th:action="@{|/rooms/${roomId}/competitions/${competitionId}|}" method="post">
                <input type="hidden" th:if="${myJoin ne null and (myJoin.grade.name() eq 'ADMIN')}" name="_method" value="delete"/>
                <button class="btn btn-outline-danger" type="submit"
                        th:if="${myJoin ne null and (myJoin.grade.name() eq 'ADMIN')}">삭제</button>
            </form>
        </div>
    </div>
    <div class="mb-4"></div>
    <div class="d-flex justify-content-center">
        <div class="m-0 p-0 row" th:each="key : ${#numbers.sequence(T(java.util.Collections).max(hashMap.keySet()), 0, -1)}"
             th:with="cnt=${T(java.lang.Math).pow(2, key)}">
            <div class="connector-area p-0 col-1" th:classappend="|round${keyStat.index}|" th:if="${!keyStat.first}">
                <div class="connector" th:each="k: ${#numbers.sequence(0, cnt - 1, 1)}">
                    <div class="home" th:classappend="${hashMap.get(key + 1).get(k * 2) == null} ? 'invisible'"></div>
                    <div class="away" th:classappend="${hashMap.get(key + 1).get(k * 2 + 1) == null} ? 'invisible'"></div>
                </div>
            </div>

            <div class="line-area p-0 col-1" th:classappend="|round${keyStat.index}|" th:if="${!keyStat.first}">
                <div class="line" th:each="k: ${#numbers.sequence(0, cnt - 1, 1)}"
                     th:classappend="${hashMap.get(key + 1).get(k * 2) == null and hashMap.get(key + 1).get(k * 2 + 1) == null} ? 'invisible'"></div>
            </div>
            <div class="p-0 col-10 flex-grow-1" th:classappend="|round${keyStat.index}|">
                <div th:each="k : ${#numbers.sequence(0, cnt - 1, 1)}" th:with="match=${hashMap.get(key).get(k)}"
                     class="match" th:classappend="${match == null} ? 'invisible'">
                    <div class="row-cols-2" th:if="${match != null}" th:onclick="(${match.home != null} or ${match.away != null}) and ${myJoin ne null and (myJoin.grade.name() eq 'ADMIN')}?|location.href='@{|/rooms/${roomId}/competitions/${competitionId}/matches/${match.id}|}'|">
                        <div class="player p-0 col-9 float-start" th:text="${match.home == null} ? |${keyStat.index}-${k * 2 + 1}경기 승자|: ${match.home.name}">home</div>
                        <div class="score p-0 col-2 offset-1 float-end" th:text="${match.homeScore}">0</div>
                        <div class="player p-0 col-9 float-start" th:text="${match.away == null} ? |${keyStat.index}-${k * 2 + 2}경기 승자|: ${match.away.name}">away</div>
                        <div class="score p-0 col-2 offset-1 float-end" th:text="${match.awayScore}">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- /container -->
<div th:replace="fragments/footer" :: footer />
</body>
</html>