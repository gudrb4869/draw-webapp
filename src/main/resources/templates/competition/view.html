<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments.html :: head"></head>
<body class="d-flex flex-column min-vh-100 bg-light">
<div th:replace="fragments.html :: navigation-bar"></div>
<div class="container">
    <div th:replace="fragments.html :: competition-info"></div>
    <div th:replace="fragments.html :: competition-menu (currentMenu='matches')"></div>
    <div class="row mt-3 justify-content-center">
        <div class="col-lg-10 py-3" th:if="${competition.isLeague()}">
            <div th:if="${matches.getTotalElements() == 0}" class="col">
                경기가 없습니다.
            </div>
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3" th:if="${matches.getTotalElements() > 0}">
                <div class="col mb-4" th:each="match: ${matches.getContent()}">
                    <a th:href="@{'/rooms/' + ${room.id} + '/competitions/' + ${competition.id} + '/matches/' + ${match.id}}" class="text-decoration-none">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <small th:text="${match.round + 1} + '라운드 / ' + ${match.number + 1} + '경기'">경기 정보</small>
                                <small th:if="${match.startDateTime == null}" class="text-warning">시간 미정</small>
                                <small th:if="${match.startDateTime != null}" class="date-time text-dark" th:text="${match.startDateTime}">경기 시간</small>
                            </div>
                            <div class="card-body text-center">
                                <div class="row">
                                    <div class="col-4">
                                        <svg th:if="${#strings.isEmpty(match.home?.image)}" th:data-jdenticon-value="${match.home?.name}" width="24" height="24" class="rounded border bg-light me-3"></svg>
                                        <img th:if="${!#strings.isEmpty(match.home?.image)}" th:src="${match.home?.image}" width="24" height="24" class="rounded border me-3"/>
                                        <span th:text="${match.home?.name}"></span>
                                    </div>
                                    <div class="col-4">
                                        <span th:text="${match.status} ? ${match?.homeScore} : '-'">3</span>
                                        <span th:if="${match?.homeScore != null and match?.awayScore != null}"> : </span>
                                        <span th:text="${match.status} ? ${match?.awayScore} : '-'">2</span>
                                    </div>
                                    <div class="col-4">
                                        <svg th:if="${#strings.isEmpty(match.away?.image)}" th:data-jdenticon-value="${match.away?.name}" width="24" height="24" class="rounded border bg-light me-3"></svg>
                                        <img th:if="${!#strings.isEmpty(match.away?.image)}" th:src="${match.away?.image}" width="24" height="24" class="rounded border me-3"/>
                                        <span th:text="${match.away?.name}"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
            <div th:replace="fragments.html :: page (pages=${matches}, url='/rooms/' + ${room.id} + '/competitions/' + ${competition.id})"></div>
        </div>

        <!--<span id="matchCallback"></span>
        <div id="singleElimination">
            <div class="demo">
            </div>
        </div>


        <div id="doubleElimination">
            <div class="demo">
            </div>
        </div>-->

        <div class="col-lg-10 tournament-bracket tournament-bracket--rounded" th:if="${competition.isTournament()}">
            <div class="tournament-bracket__round" th:classappend="'tournament-bracket__round--' + ${round - key}" th:each="key : ${#numbers.sequence(round, 0, -1)}"
                 th:with="cnt=${T(java.lang.Math).pow(2, round - key)}">
                <h3 class="tournament-bracket__round-title" th:text="${key == 0} ? '결승' : (${key == 1} ? '준결승' : (${key == 2} ? '8강' : (${key == 3} ? '16강' : (${key == 4} ? '32강' : (${key == 5} ? '64강' : _)))))"></h3>
                <ul class="tournament-bracket__list">
                    <li class="tournament-bracket__item" th:each="match : ${matches.get(key)}"
                        th:onclick="${!match.closed} ? |location.href='@{|/rooms/${room.id}/competitions/${competition.id}/matches/${match.id}|}'|">
                        <div class="tournament-bracket__match" tabindex="0">
                            <table class="tournament-bracket__table">
                                <caption class="tournament-bracket__caption">
                                    <span th:if="${match.closed}">부전승</span>
                                    <span th:if="${!match.closed and match.startDateTime == null}" class="text-warning">시간 미정</span>
                                    <span th:if="${!match.closed and match.startDateTime != null}" class="date-time text-dark" th:text="${match.startDateTime}">경기 시간</span>
                                </caption>
                                <thead class="sr-only">
                                <tr>
                                    <th>Image</th>
                                    <th>Team</th>
                                    <th>Score</th>
                                </tr>
                                </thead>
                                <tbody class="tournament-bracket__content">
                                <tr class="tournament-bracket__team" th:classappend="${match.homeScore > match.awayScore} ? 'tournament-bracket__team--winner'"
                                    tabindex="0" data-bs-toggle="tooltip" data-bs-placement="top" th:title="${match?.home?.name}">
                                    <td class="tournament-bracket__country">
                                        <svg th:if="${#strings.isEmpty(match?.home?.image)}" th:data-jdenticon-value="${match?.home?.name}" width="24" height="24" class="rounded border bg-light"></svg>
                                        <img th:if="${!#strings.isEmpty(match?.home?.image)}" th:src="${match?.home?.image}" width="24" height="24" class="rounded border"/>
                                    </td>
                                    <td class="tournament-bracket__code">
                                        <span th:text="${match?.home?.name}"></span>
                                    </td>
                                    <td class="tournament-bracket__score">
                                        <span class="tournament-bracket__number" th:text="${match.status} ? ${match?.homeScore} : '-'">4</span>
                                    </td>
                                </tr>
                                <tr class="tournament-bracket__team" th:classappend="${match.homeScore < match.awayScore} ? 'tournament-bracket__team--winner'"
                                    tabindex="0" data-bs-toggle="tooltip" data-bs-placement="bottom" th:title="${match?.away?.name}">
                                    <td class="tournament-bracket__country">
                                        <svg th:if="${#strings.isEmpty(match?.away?.image)}" th:data-jdenticon-value="${match?.away?.name}" width="24" height="24" class="rounded border bg-light"></svg>
                                        <img th:if="${!#strings.isEmpty(match?.away?.image)}" th:src="${match?.away?.image}" width="24" height="24" class="rounded border"/>
                                    </td>
                                    <td class="tournament-bracket__code">
                                        <span th:text="${match?.away?.name}"></span>
                                    </td>
                                    <td class="tournament-bracket__score">
                                        <span class="tournament-bracket__number" th:text="${match.status} ? ${match?.awayScore} : '-'">1</span>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
<!--                            <div th:replace="fragments.html :: match"></div>-->
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div> <!-- /container -->
<div th:replace="fragments.html :: footer"></div>
<script th:replace="fragments.html :: date-time"></script>
<script th:replace="fragments.html :: tooltip"></script>
<script type="application/javascript">
    $(function () {
        let $tournament = $('.tournament-bracket__country');
        console.log($tournament);
        let $name = $('.tournament-bracket__code');
        console.log($name);
    })
</script>
<!--<script type="text/javascript" src="/node_modules/jquery-bracket/dist/jquery.bracket.min.js"></script>
<script type="application/javascript" th:inline="javascript">
    /*[# th:each="member : ${members}"]
    console.log([[${member.name}]]);
    [/]*/
    var singleElimination = {
        teams : [
            ["Team 1", "Team 2"],
            ["Team 3", "Team 4"],
            ["Team 5", "Team 6"],
            ["Team 7", "Team 8"],
            ["Team 9", "Team 10"],
            ["Team 11", "Team 12"],
            ["Team 13", "Team 14"],
            ["Team 15", "Team 16"]
        ],
        results : [
            //first round - last 16
            [
                [4,3,'Match 1'],
                [1,4,'Match 2'],
                [1,4,'Match 3'],
                [1,4,'Match 4'],
                [6,4,'Match 5'],
                [1,4,'Match 6'],
                [1,4,'Match 7'],
                [1,4,'Match 8']
            ],
            //second round - Quarter Final
            [
                [4,3,'Match 9'],
                [1,4,'Match 10'],
                [1,4,'Match 11'],
                [1,4,'Match 12']
            ],
            //third round - Semi Final
            [
                [4,3,'Match 13'],
                [1,4,'Match 14']
            ],
            //fourth round - Final
            [
                [], //winners
                [1,4,'Match 16'] //third place
            ]
        ]
    }

    var doubleElimination = {
        teams : [
            ["Team 1", "Team 2"],
            ["Team 3", "Team 4"],
            ["Team 5", "Team 6"],
            ["Team 7", "Team 8"],
            ["Team 9", "Team 10"],
            ["Team 11", "Team 12"],
            ["Team 13", "Team 14"],
            ["Team 15", "Team 16"]
        ],
        results : [
            // Winner Bracket
            [
                //first round - last 16
                [
                    [4,3,'Match 1'], [1,4,'Match 2'], [1,4,'Match 3'], [1,4,'Match 4'], [6,4,'Match 5'], [1,4,'Match 6'], [1,4,'Match 7'], [1,4,'Match 8']
                ],
                //second round - Quarter Final
                [
                    [4,3,'Match 9'], [1,4,'Match 10'], [1,4,'Match 11'], [1,4,'Match 12']
                ],
                //third round - Semi Final
                [
                    [4,3,'Match 13'], [1,4,'Match 14']
                ],
                //fourth round - Final
                [
                    [1,4,'Match 15'] //third place
                ]
            ],
            // Loser Bracket
            [
                [
                    [5,1], [1,2], [3,2], [6,9]
                ],
                [
                    [8,2], [1,2], [6,2], [1,3]
                ],
                [
                    [1,2], [3,1]
                ],
                [
                    [3,0], [1,0]
                ],
                [
                    [3,2]
                ],
                [
                    [4,2]
                ]
            ],
            // Finals
            [
                [
                    [3,8], [1,2]
                ],
                [
                    [2,1]
                ]
            ]
        ]
    }

    function onclick(data) {
        $('#matchCallback').text("onclick(data: '" + data + "')")
    }

    function onhover(data, hover) {
        $('#matchCallback').text("onhover(data: '" + data + "', hover: " + hover + ")")
    }

    $(function() {
        $('div#singleElimination .demo').bracket({
            init: singleElimination,
            onMatchClick: onclick,
            onMatchHover: onhover
        })

        /*$('div#doubleElimination .demo').bracket({
            skipSecondaryFinal: true,
            // skipConsolationRound: true,
            init: doubleElimination,
            onMatchClick: onclick,
            onMatchHover: onhover
        })*/
    })
</script>-->
</body>
</html>