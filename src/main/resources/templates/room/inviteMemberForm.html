<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<body class="d-flex flex-column min-vh-100 bg-light">
<div th:replace="fragments/bodyheader" :: bodyheader />
<div class="container">
    <div class="py-5 text-center">
        <h2>멤버 초대</h2>
    </div>
    <div class="row mx-auto justify-content-center">
        <form class="col-md-6 mx-auto" th:action th:object="${inviteForm}" method="post">

            <div th:if="${#fields.hasGlobalErrors()}">
                <p class="text-danger" th:each="err : ${#fields.globalErrors()}" th:text="${err}">전체 오류 메시지</p>
            </div>

            <div class="mb-3">
                <label th:for="count">초대 인원수</label>
                <select th:field="*{count}" class="form-select" th:errorclass="border-danger" onchange="updateForm()">
                    <option th:each="count : ${#numbers.sequence(1, 100)}" th:value="${count}" th:text="${count}"></option>
                </select>
                <p th:errors="*{count}" class="text-danger">인원수 오류</p>
            </div>

            <table class="table table-hover">
                <thead>
                <tr>
                    <th>번호</th>
                    <th>아이디</th>
                </tr>
                </thead>
                <tbody id="emails" name="emails">
                <tr th:each="email : *{emails}">
                    <td th:text="${emailStat.count}"></td>
                    <td>
                        <input type="text" th:field="*{emails[__${emailStat.index}__]}"
                               class="form-control" th:errorclass="is-invalid"/>
                        <p th:errors="*{emails[__${emailStat.index}__]}" class="text-danger">이메일 형식이 올바르지 않음</p>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="row">
                <div class="col">
                    <button type="submit" class="btn btn-outline-dark">초대</button>
                    <button type="button" class="btn btn-outline-dark" th:onclick="|location.href='@{|/rooms/${roomId}|}'|">취소</button>
                </div>
            </div>
        </form>
        <div class="mb-4"></div>
    </div>
</div> <!-- /container -->
<div th:replace="fragments/footer" :: footer />
</body>
<script>
    const add_textbox = () => {
        const box = document.getElementById("box");
        const newP = document.createElement('p');
        newP.innerHTML = "<input type='text'> <input type='button' value='삭제' onclick='remove(this)'>";
        box.appendChild(newP);
    }
    const remove = (obj) => {
        document.getElementById('box').removeChild(obj.parentNode);
    }
</script>
<script th:inline="javascript">
    let updateForm = () => {
        let count = document.getElementById("count").value;
        let emails = document.getElementById("emails");
        let n = emails.childElementCount;
        if (count > n) {
            for (let i = n + 1; i <= count; i++) {
                const email = document.createElement('tr')
                email.innerHTML = "<tr><td>" + i + "</td>" +
                    "<td><input type='text' name='emails[" + (i - 1) + "]' class='form-control'/></td>" +
                    "</tr>";
                emails.appendChild(email);
            }
        }
        else {
            for (let i = n; i > count; i--) {
                emails.lastElementChild.remove();
            }
        }
    }
</script>
</html>