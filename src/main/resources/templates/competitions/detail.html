<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<style>
    .tournament {
        height: 650px;
        float: left;
    }

    .match {
        width: 150px;
        height: 520px;
        float: right;
    }

    .match > div {
        width: 180px;
        height: 55px;
        border: 3px solid #000000;
        margin: 10px 0;
        background: #73789F;
        color: white;
        padding: 3px 3px 3px 6px;
    }

    .match > div:nth-child(2n) {
        margin-bottom: 40px;
    }

    .connector {
        width: 40px;
        height: 520px;
        float: right;
    }

    .line {
        width: 50px;
        height: 520px;
        float: right;
    }

    .connector div {
        border: 3px solid #000000;
        border-left: none;
        height: 70px;
        width: 100%;
        margin: 90px 0 0 27px;
    }

    .connector div:first-child {
        margin: 35px 0 0 27px;
    }

    .line div {
        border-top: 3px solid #000000;
        margin: 158px 0 0 27px;
    }

    .line div:first-child {
        margin-top: 65px;
    }

    #round2 > div {
        margin-top: 103px;
    }

    #round2 > div:first-child {
        margin-top: 43px;
    }

    #conn1 div {
        margin-top: 151px;
        height: 166px;
    }

    #conn1 div:first-child {
        margin-top: 65px;
    }

    #line1 div {
        margin-top: 315px;
    }

    #line1 div:first-child {
        margin-top: 148px;
    }
    #round1 > div {
        margin-top: 260px;
    }
    #round1 > div:first-child {
        margin-top: 125px;
    }
    #conn0 div {
        margin-top: 150px;
        height: 320px;
    }

    #line0 div {
        margin-top: 320px;
    }

    #round0 > div {
        margin-top: 290px;
    }
</style>
<!--<style>
    .tournament{width:720px;}

    .round{
        float:left;
    }

    .player{
        font-family:arial;
        width:120px;
        height:20px;
        padding:10px;
        background:#73789F;
        color:white;
    }

    .player.winner{background:green;}

    .match{
        padding:5px 50px 5px 0px;
    }

    /*QUARTER-FINALS*/
    .quarter-finals .match{
        height:100px;
        background:right top no-repeat url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABkAQMAAAD+JvEYAAAAA3NCSVQICAjb4U/gAAAABlBMVEUAAAD///+l2Z/dAAAACXBIWXMAAAsSAAALEgHS3X78AAAAFnRFWHRDcmVhdGlvbiBUaW1lADEwLzEwLzEyGAKeIwAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNAay06AAAAAnSURBVCiRY/gPBgcYhjoNBPZQ/v4hQjeAHD0I3IGXRgpXqsbXEKEB2yGL0P7iVKIAAAAASUVORK5CYII=);
    }
    .quarter-finals .player{

    }
    .quarter-finals .player:first-child{
        margin-bottom:5px;
    }

    /*SEMI-FINALS*/
    .semi-finals .match{
        padding-top:30px;
        height:185px;
        background:right top no-repeat url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAC5AQMAAABQhv7pAAAAA3NCSVQICAjb4U/gAAAABlBMVEUAAAD///+l2Z/dAAAACXBIWXMAAAsSAAALEgHS3X78AAAAFnRFWHRDcmVhdGlvbiBUaW1lADEwLzEwLzEyGAKeIwAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNAay06AAAAArSURBVDiNY/gPBgcYRumBpYHAHsrfP0oPKboBFHmDwB2jNAk0Un77PwxoAJbztvAUr3KAAAAAAElFTkSuQmCC);
    }

    .semi-finals .player:first-child{
        margin-bottom:70px;
    }

    /*FINALS*/
    .finals .match{
        padding-top:85px;
        height:350px;
        background:top right no-repeat url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAFeAQMAAAD9sN5nAAAAA3NCSVQICAjb4U/gAAAABlBMVEUAAAD///+l2Z/dAAAACXBIWXMAAAsSAAALEgHS3X78AAAAFnRFWHRDcmVhdGlvbiBUaW1lADEwLzEwLzEyGAKeIwAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNAay06AAAAA0SURBVEiJY/gPBgcYRulRepQmngYCeyh//yg9So/Sg45uAGXSQeCOUXqUHrI0Uj33fxjQAEJS8U50LMSKAAAAAElFTkSuQmCC);
    }

    .finals .player:first-child{
        margin-bottom:180px;

    }
    /* CHAMP*/
    .champion{padding-top:200px;}
</style>-->
<body>
<div>
    <div th:replace="fragments/bodyheader" :: bodyheader />
    <!--<div class="tournament">

        <div class="round quarter-finals">

            <div class="match" >
                <div class="player">Player 1</div>
                <div class="player winner">Player 2</div>
            </div>

            <div class="match">
                <div class="player winner">Player 3</div>
                <div class="player">Player 4</div>
            </div>

            <div class="match">
                <div class="player">Player 5</div>
                <div class="player winner">Player 6</div>
            </div>

            <div class="match">
                <div class="player">Player 7</div>
                <div class="player">Player 8</div>
            </div>

        </div>

        <div class="round semi-finals">

            <div class="match">
                <div class="player">Player 2</div>
                <div class="player winner">Player 3</div>
            </div>

            <div class="match">
                <div class="player">Player 6</div>
                <div class="player">Player 7</div>
            </div>

        </div>

        <div class="round finals">

            <div class="match">
                <div class="player">Player 3</div>
                <div class="player"></div>
            </div>

        </div>

        <div class="round">
            <div class="champion">
                <div class="player"></div>
            </div>
        </div>
    </div>-->
    <table class="table table-striped">
        <thead>
        <tr>
            <th>대회 이름</th>
            <th>대회 방식</th>
            <th>참여 인원수</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td th:text="${competition.title}"></td>
            <td th:text="${competition.competitionType}"></td>
            <td th:text="${joins.size()}"></td>
        </tr>
        </tbody>
    </table>

    <div class="my-2 my-lg-0">
        <a th:href="@{|/rooms/${roomId}|}" class="btn btn-warning">목록</a>
        <a class="btn btn-secondary my-2 my-sm-0" th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}"
           th:href="@{|/rooms/${roomId}/competitions/${competitionId}/edit|}">수정</a>
        <form class="form-check-inline my-2 my-lg-0" th:action="@{|/rooms/${roomId}/competitions/${competitionId}|}" method="post">
            <input type="hidden" th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}" name="_method" value="delete"/>
            <button class="btn btn-danger my-2 my-sm-0" type="submit"
                    th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}">삭제</button>
        </form>
    </div>

    <h1>대회 참여자 목록</h1>
    <table class="table table-light">
        <thead>
        <tr>
            <th>이름</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="join : ${joins}">
            <td th:text="|${join.member.email}(${join.member.name})|"></td>
        </tr>
        </tbody>
    </table>

    <hr class="my-4">
    <h1>일정</h1>
    <div th:if="${competition.competitionType.name() == 'LEAGUE'}">
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>라운드</th>
                <th>경기#</th>
                <th> 홈 </th>
                <th></th>
                <th></th>
                <th></th>
                <th> 어웨이 </th>
                <th></th>
                <th></th>
            </tr>
            </thead>
            <tbody th:each="matches : ${hashMap.entrySet()}">
            <tr th:each="match : ${matches.getValue()}">
                <td th:text="${match.roundNo}"></td>
                <td th:text="${match.matchNo}"></td>
                <td th:text="${match.home == null} ? ${match.roundNo + 1} + '-' + ${match.matchNo * 2} + '경기 승자'
                : ${match.home.email + '('+ match.home.name + ')'}"></td>
                <td th:text="${match.score.homeScore}"></td>
                <td>:</td>
                <td th:text="${match.score.awayScore}"></td>
                <td th:text="${match.away == null} ? ${match.roundNo + 1} + '-' + ${match.matchNo * 2 + 1} + '경기 승자'
                : ${match.away.email + '('+ match.away.name + ')'}"></td>
                <td th:text="${match.matchStatus.description}"></td>
                <td>
                    <a class="btn btn-primary"
                       th:if="${match.home != null} and ${match.away != null} and ${match.matchStatus.name() eq 'READY'}
                    and ${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}"
                       th:href="@{|/rooms/${roomId}/competitions/${competitionId}/matches/${match.id}/update|}">수정</a>
                    <a class="btn btn-primary"
                       th:if="${match.home != null} and ${match.away != null} and ${match.matchStatus.name() eq 'END'}
                    and ${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}"
                       th:href="'javascript:init('+${roomId}+', '+${competitionId}+', '+${match.id}+')'">초기화</a>
                </td>
            </tr>
            </tbody>
        </table>
        <hr class="my-4">
        <h1>순위</h1>
        <table class="table table-light">
            <thead>
            <tr>
                <th>#</th>
                <th>이름</th>
                <th>경기수</th>
                <th>승</th>
                <th>무</th>
                <th>패</th>
                <th>승점</th>
                <th>득점</th>
                <th>실점</th>
                <th>골득실</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="join : ${joins}">
                <td th:text="${joinStat.count}"></td>
                <td th:text="${join.member.email + '('+ join.member.name + ')'}"></td>
                <td th:text="${join.result.win} + ${join.result.draw} + ${join.result.lose}"></td>
                <td th:text="${join.result.win}"></td>
                <td th:text="${join.result.draw}"></td>
                <td th:text="${join.result.lose}"></td>
                <td th:text="${join.result.win * 3} + ${join.result.draw}"></td>
                <td th:text="${join.result.goalFor}"></td>
                <td th:text="${join.result.goalAgainst}"></td>
                <td th:text="${join.result.goalFor} - ${join.result.goalAgainst}"></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div th:if="${competition.competitionType.name() == 'TOURNAMENT'}">
        <div class="tournament">
            <a th:each="matches : ${hashMap.entrySet()}">
                <div class="match" th:id="|round${matchesStat.index}|">
                    <div th:each="match : ${matches.getValue()}">
                        <h6 th:text="${match.home == null} ? ${matchesStat.count} + '-' + ${matchStat.count * 2 - 1} + '경기 승자'
                        : ${match.home.email} + '(' + ${match.home.name} + ')'"></h6>
                        <h6 th:text="${match.away == null} ? ${matchesStat.count} +'-' + ${matchStat.count * 2} + '경기 승자'
                        : ${match.away.email} + '(' + ${match.away.name} + ')'"></h6>
                    </div>
                </div>

                <div class="line" th:id="|line${matchesStat.index}|">
                    <div th:each="match : ${matches.getValue()}"></div>
                </div>

                <div class="connector" th:id="|conn${matchesStat.index}|">
                    <div th:each="match : ${matches.getValue()}"></div>
                </div>
            </a>
        </div>
        <hr class="my-4">
        <h1>우승팀</h1>
        <h2 th:if="${hashMap.get(0).get(0).score.homeScore > hashMap.get(0).get(0).score.awayScore}"
            th:text="${hashMap.get(0).get(0).home == null} ? 'null'
                : ${hashMap.get(0).get(0).home.email + '('+ hashMap.get(0).get(0).home.name + ')'}">우승자</h2>
        <h2 th:if="${hashMap.get(0).get(0).score.homeScore < hashMap.get(0).get(0).score.awayScore}"
            th:text="${hashMap.get(0).get(0).away == null} ? 'null'
                : ${hashMap.get(0).get(0).away.email + '('+ hashMap.get(0).get(0).away.name + ')'}">우승자</h2>
        <h2 th:if="${hashMap.get(0).get(0).score.homeScore == hashMap.get(0).get(0).score.awayScore}"
            th:text="'대회 진행중'">우승자</h2>
    </div>
    <div th:replace="fragments/footer" :: footer />
</div> <!-- /container -->
</body>
<script>
    function init(roomId, competitionId, matchId) {
        var form = document.createElement("form");
        form.setAttribute("method", "post");
        form.setAttribute("action", "/rooms/" + roomId + "/competitions/" + competitionId + "/matches/" + matchId + "/init");
        document.body.appendChild(form);
        form.submit();
    }
</script>
</html>
