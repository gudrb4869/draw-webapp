<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<style>
    .match {
        width: 100%;
        height: 60px;
        border: 2px solid black;
        margin: 10px 0;
        background: gray;
        color: white;
    }

    .player {
        font-family:arial;
        overflow: hidden;
        /*text-overflow: ellipsis;*/
        white-space: nowrap;
        color:white;
        float: left;
        text-align: center;
    }

    .score {
        font-family:arial;
        color:white;
        float: right;
        text-align: center;
    }

    .round0 .match:first-child {
        margin-top: 5px;
    }
    .round0 .match {
        margin-top: 10px;
    }
    .round1 .match:first-child {
        margin-top: 40px;
    }
    .round1 .match {
        margin-top: 80px;
    }
    .round2 .match:first-child {
        margin-top: 110px;
    }
    .round2 .match {
        margin-top: 220px;
    }
    .round3 .match:first-child {
        margin-top: 250px;
    }
    .round3 .match {
        margin-top: 500px;
    }
    .round4 .match:first-child {
        margin-top: 530px;
    }
    .round4 .match {
        margin-top: 1060px;
    }
    .round5 .match:first-child {
        margin-top: 1090px;
    }

    .connector-area {
        width: 5%;
    }
    .connector {
    }
    .home {
        border: 2px solid black;
        border-left: none;
        border-bottom: none;
        height: 50px;
        width: 100%;
    }
    .away {
        border: 2px solid black;
        border-left: none;
        border-top: none;
        height: 50px;
        width: 100%;
    }
    .round1 .connector:first-child {
        margin-top: 36px;
    }
    .round1 .connector {
        margin-top: 70px;
    }
    .round1 .home {
        height: 35px;
    }
    .round1 .away {
        height: 35px;
    }
    .round2 .connector:first-child {
        margin-top: 69px;
    }
    .round2 .connector {
        margin-top: 136px;
    }
    .round2 .home {
        height: 72px;
    }
    .round2 .away {
        height: 72px;
    }
    .round3 .connector:first-child {
        margin-top: 139px;
    }
    .round3 .connector {
        margin-top: 276px;
    }
    .round3 .home {
        height: 142px;
    }
    .round3 .away {
        height: 142px;
    }
    .round4 .connector:first-child {
        margin-top: 279px;
    }
    .round4 .connector {
        margin-top: 556px;
    }
    .round4 .home {
        height: 282px;
    }
    .round4 .away{
        height: 282px;
    }
    .round5 .connector:first-child {
        margin-top: 559px;
    }
    .round5 .connector {
        margin-top: 1120px;
    }
    .round5 .home {
        height: 562px;
    }
    .round5 .away {
        height: 562px;
    }
    .line-area {
        width: 5%;
    }

    .line {
        border-top: 2px solid black;
    }
    .round1 .line:first-child {
        margin-top: 69px;
    }
    .round1 .line {
        margin-top: 138px;
    }
    .round2 .line:first-child {
        margin-top: 139px;
    }
    .round2 .line {
        margin-top: 278px;
    }
    .round3 .line:first-child {
        margin-top: 279px;
    }
    .round3 .line {
        margin-top: 558px;
    }
    .round4 .line:first-child {
        margin-top: 559px;
    }
    .round4 .line {
        margin-top: 1118px;
    }
    .round5 .line:first-child {
        margin-top: 1119px;
    }
</style>
<body class="d-flex flex-column min-vh-100">
<div th:replace="fragments/bodyheader" :: bodyheader />
<div class="container">
    <table class="table table-hover">
        <thead>
        <tr>
            <th class="col-4">대회명</th>
            <th class="col-4">대회방식</th>
            <th class="col-4">참여자수</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td class="col-4" th:text="${competition.title}"></td>
            <td class="col-4" th:text="${competition.competitionType}"></td>
            <td class="col-4" th:text="${joins.size()}"></td>
        </tr>
        </tbody>
    </table>

    <div class="row">
        <div class="col">
            <button type="button" class="btn btn-default pull-right" th:onclick="|location.href='@{|/rooms/${roomId}|}'|">목록</button>
            <button type="button" class="btn btn-default pull-right" th:onclick="|location.href='@{|/rooms/${roomId}/competitions/${competitionId}/edit|}'|"
                    th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}">수정</button>
            <form class="pull-right" th:action="@{|/rooms/${roomId}/competitions/${competitionId}|}" method="post">
                <input type="hidden" th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}" name="_method" value="delete"/>
                <button class="btn btn-danger" type="submit"
                        th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}">삭제</button>
            </form>
        </div>
    </div>
    <div class="mb-4"></div>
    <!--<h1>대회참여자</h1>
    <table class="table table-light">
        <tbody>
        <tr th:each="join : ${joins}">
            <td th:text="|${join.member.email}(${join.member.name})|"></td>
        </tr>
        </tbody>
    </table>-->

    <div class="row justify-content-center" th:if="${competition.competitionType.name() == 'LEAGUE'}">
        <table class="table table-hover">
            <h3>일정</h3>
            <tbody th:each="key : ${hashMap.keySet()}">
            <tr>
                <td class="col-2" th:text="|${key + 1}라운드|"></td>
                <td class="col-10">
                    <div class="row justify-content-center p-0 m-0">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th class="col-4">홈</th>
                                <th class="col-4">스코어</th>
                                <th class="col-4">어웨이</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="k : ${hashMap.get(key).keySet()}" th:with="match=${hashMap.get(key).get(k)}"
                                th:onclick="${match.home != null} and ${match.away != null} and ${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}? |location.href='@{|/rooms/${roomId}/competitions/${competitionId}/matches/${match.id}/update|}'| :_">
                                <td class="col-4" th:text="|${match.home.email}(${match.home.name})|">홈팀명</td>
                                <td class="col-4" th:text="|${match.score.homeScore}:${match.score.awayScore}|">스코어</td>
                                <td class="col-4" th:text="|${match.away.email}(${match.away.name})|">어웨이팀명</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="row justify-content-center" th:if="${competition.competitionType.name() == 'LEAGUE'}">
        <table class="table table-hover">
            <h3>순위</h3>
            <thead>
            <tr>
                <th class="col-1">#</th>
                <th class="col-3">회원명</th>
                <th class="col-1">경기수</th>
                <th class="col-1">승</th>
                <th class="col-1">무</th>
                <th class="col-1">패</th>
                <th class="col-1">승점</th>
                <th class="col-1">득점</th>
                <th class="col-1">실점</th>
                <th class="col-1">득실차</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="join : ${joins}">
                <td class="col-1" th:text="${joinStat.count}"></td>
                <td class="col-3" th:text="|${join.member.email}(${join.member.name})|"></td>
                <td class="col-1" th:text="${join.result.win} + ${join.result.draw} + ${join.result.lose}"></td>
                <td class="col-1" th:text="${join.result.win}"></td>
                <td class="col-1" th:text="${join.result.draw}"></td>
                <td class="col-1" th:text="${join.result.lose}"></td>
                <td class="col-1"><strong th:text="${join.result.win * 3} + ${join.result.draw}"></strong></td>
                <td class="col-1" th:text="${join.result.goalFor}"></td>
                <td class="col-1" th:text="${join.result.goalAgainst}"></td>
                <td class="col-1" th:text="${join.result.goalFor} - ${join.result.goalAgainst}"></td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
        <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">Generate Report</a>
    </div>

    <div class="row">
        <!-- Earnings (Monthly) Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Earnings (Monthly)</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">$40,000</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-calendar fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Earnings (Monthly) Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Earnings (Annual)</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">$215,000</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Earnings (Monthly) Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Tasks
                            </div>
                            <div class="row no-gutters align-items-center">
                                <div class="col-auto">
                                    <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">50%</div>
                                </div>
                                <div class="col">
                                    <div class="progress progress-sm mr-2">
                                        <div class="progress-bar bg-info" role="progressbar"
                                             style="width: 50%" aria-valuenow="50" aria-valuemin="0"
                                             aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pending Requests Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Pending Requests</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">18</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-comments fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-center" th:if="${competition.competitionType.name() == 'TOURNAMENT'}">
        <div class="m-0 p-0 row" th:each="key : ${#numbers.sequence(T(java.util.Collections).max(hashMap.keySet()), 0, -1)}"
             th:with="cnt=${T(java.lang.Math).pow(2, key)}">
            <div class="connector-area p-0 col-1" th:classappend="|round${keyStat.index}|" th:if="${!keyStat.first}">
                <div class="connector" th:each="k: ${#numbers.sequence(0, cnt - 1, 1)}">
                    <div class="home" th:classappend="${hashMap.get(key + 1).get(k * 2) == null} ? 'invisible'"></div>
                    <div class="away" th:classappend="${hashMap.get(key + 1).get(k * 2 + 1) == null} ? 'invisible'"></div>
                </div>
            </div>

            <div class="line-area p-0 col-1" th:classappend="|round${keyStat.index}|" th:if="${!keyStat.first}">
                <div class="line" th:each="k: ${#numbers.sequence(0, cnt - 1, 1)}"
                     th:classappend="${hashMap.get(key + 1).get(k * 2) == null and hashMap.get(key + 1).get(k * 2 + 1) == null} ? 'invisible'"></div>
            </div>
            <div class="p-0 col-10 flex-grow-1" th:classappend="|round${keyStat.index}|">
                <div th:each="k : ${#numbers.sequence(0, cnt - 1, 1)}" th:with="match=${hashMap.get(key).get(k)}"
                     class="match" th:classappend="${match == null} ? 'invisible'">
                    <div class="row-cols-2" th:if="${match != null}" th:onclick="${match.home != null} and ${match.away != null} and ${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}?|location.href='@{|/rooms/${roomId}/competitions/${competitionId}/matches/${match.id}/update|}'|">
                        <div class="player p-0 col-9 float-start" th:text="${match.home == null} ? |${keyStat.index}-${k * 2 + 1}경기 승자|: |${match.home.email}(${match.home.name})|">home</div>
                        <div class="score p-0 col-2 offset-1 float-end" th:text="${match.score.homeScore}">0</div>
                        <div class="player p-0 col-9 float-start" th:text="${match.away == null} ? |${keyStat.index}-${k * 2 + 2}경기 승자|: |${match.away.email}(${match.away.name})|">away</div>
                        <div class="score p-0 col-2 offset-1 float-end" th:text="${match.score.awayScore}">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- /container -->
<div th:replace="fragments/footer" :: footer />
</body>
</html>
