<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<body>
<div class="container" style="max-width: 600px">
    <div th:replace="fragments/bodyheader" :: bodyheader />
    <table class="table table-striped">
        <thead>
        <tr>
            <th>대회 이름</th>
            <th>대회 방식</th>
            <th>참여 인원수</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td th:text="${competition.title}"></td>
            <td th:text="${competition.competitionType}"></td>
            <td th:text="${joins.size()}"></td>
        </tr>
        </tbody>
    </table>

    <div class="my-2 my-lg-0">
        <a th:href="@{|/rooms/${roomId}|}" class="btn btn-warning">목록</a>
        <a class="btn btn-secondary my-2 my-sm-0" th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}"
           th:href="@{|/rooms/${roomId}/competitions/${competitionId}/edit|}">수정</a>
        <form class="form-check-inline my-2 my-lg-0" th:action="@{|/rooms/${roomId}/competitions/${competitionId}|}" method="post">
            <input type="hidden" th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}" name="_method" value="delete"/>
            <button class="btn btn-danger my-2 my-sm-0" type="submit"
                    th:if="${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}">삭제</button>
        </form>
    </div>

    <h1>대회 참여자 목록</h1>
    <table class="table table-light" style="max-width: 600px">
        <thead>
        <tr>
            <th>이름</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="join : ${joins}">
            <td th:text="${join.member.email + '('+ join.member.name + ')'}"></td>
        </tr>
        </tbody>
    </table>

    <hr class="my-4">
    <h1>일정</h1>
    <table class="table table-bordered">
        <thead>
        <tr>
            <th>라운드</th>
            <th>경기#</th>
            <th> 홈 </th>
            <th></th>
            <th></th>
            <th></th>
            <th> 어웨이 </th>
            <th></th>
            <th></th>
        </tr>
        </thead>
        <tbody th:each="matches : ${hashMap.entrySet()}">
        <tr th:each="match : ${matches.getValue()}">
            <td th:text="${match.roundNo}"></td>
            <td th:text="${match.matchNo}"></td>
            <td th:text="${match.home == null} ? ${match.roundNo + 1} + '-' + ${match.matchNo * 2} + '경기 승자'
                : ${match.home.email + '('+ match.home.name + ')'}"></td>
            <td th:text="${match.score.homeScore}"></td>
            <td>:</td>
            <td th:text="${match.score.awayScore}"></td>
            <td th:text="${match.away == null} ? ${match.roundNo + 1} + '-' + ${match.matchNo * 2 + 1} + '경기 승자'
                : ${match.away.email + '('+ match.away.name + ')'}"></td>
            <td th:text="${match.matchStatus.description}"></td>
            <td>
                <a class="btn btn-primary"
                   th:if="${match.home != null} and ${match.away != null} and ${match.matchStatus.name() eq 'READY'}
                    and ${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}"
                   th:href="@{|/rooms/${roomId}/competitions/${competitionId}/matches/${match.id}/update|}">수정</a>
                <a class="btn btn-primary"
                   th:if="${match.home != null} and ${match.away != null} and ${match.matchStatus.name() eq 'END'}
                    and ${myBelong ne null and (myBelong.belongType.name() eq 'ADMIN')}"
                   th:href="'javascript:init('+${roomId}+', '+${competitionId}+', '+${match.id}+')'">초기화</a>
            </td>
        </tr>
        </tbody>
    </table>

    <div th:if="${competition.competitionType.name() == 'LEAGUE'}">
        <hr class="my-4">
        <h1>순위</h1>
        <table class="table table-light">
            <thead>
            <tr>
                <th>#</th>
                <th>이름</th>
                <th>경기수</th>
                <th>승</th>
                <th>무</th>
                <th>패</th>
                <th>승점</th>
                <th>득점</th>
                <th>실점</th>
                <th>골득실</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="join : ${joins}">
                <td th:text="${joinStat.count}"></td>
                <td th:text="${join.member.email + '('+ join.member.name + ')'}"></td>
                <td th:text="${join.result.win} + ${join.result.draw} + ${join.result.lose}"></td>
                <td th:text="${join.result.win}"></td>
                <td th:text="${join.result.draw}"></td>
                <td th:text="${join.result.lose}"></td>
                <td th:text="${join.result.win * 3} + ${join.result.draw}"></td>
                <td th:text="${join.result.goalFor}"></td>
                <td th:text="${join.result.goalAgainst}"></td>
                <td th:text="${join.result.goalFor} - ${join.result.goalAgainst}"></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div th:if="${competition.competitionType.name() == 'TOURNAMENT'}">
        <hr class="my-4">
        <h1>우승팀</h1>
        <h2 th:if="${hashMap.get(0).get(0).score.homeScore > hashMap.get(0).get(0).score.awayScore}"
            th:text="${hashMap.get(0).get(0).home == null} ? 'null'
                : ${hashMap.get(0).get(0).home.email + '('+ hashMap.get(0).get(0).home.name + ')'}">우승자</h2>
        <h2 th:if="${hashMap.get(0).get(0).score.homeScore < hashMap.get(0).get(0).score.awayScore}"
            th:text="${hashMap.get(0).get(0).away == null} ? 'null'
                : ${hashMap.get(0).get(0).away.email + '('+ hashMap.get(0).get(0).away.name + ')'}">우승자</h2>
        <h2 th:if="${hashMap.get(0).get(0).score.homeScore == hashMap.get(0).get(0).score.awayScore}"
            th:text="'대회 진행중'">우승자</h2>
    </div>
    <div th:replace="fragments/footer" :: footer />
</div> <!-- /container -->
</body>
<script>
    function init(roomId, competitionId, matchId) {
        var form = document.createElement("form");
        form.setAttribute("method", "post");
        form.setAttribute("action", "/rooms/" + roomId + "/competitions/" + competitionId + "/matches/" + matchId + "/init");
        document.body.appendChild(form);
        form.submit();
    }
</script>
</html>
<!--
<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<body>
<div class="container">
    <div th:replace="fragments/bodyheader" :: bodyheader />
    <table class="table table-striped">
        <thead>
        <tr>
            <th>대회 제목</th>
            <th>대회 방식</th>
            <th>참여 인원수</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td th:text="${competition.title}"></td>
            <td th:text="${competition.competitionType}"></td>
            <td th:text="${competition.headCount}"></td>
        </tr>
        </tbody>
    </table>

    <div class="my-2 my-lg-0">
        <a th:href="@{|/room/${roomId}|}" class="btn btn-warning">목록</a>
    </div>
    <div class="text-center py-2" style="max-width: 600px">
        <hr class="my-4">
    </div>
    <hr class="my-4">
    <h1>일정</h1>
    <table class="table table-bordered">
        <thead>
        <tr>
            <th>라운드</th>
            <th>경기#</th>
            <th> 홈 </th>
            <th></th>
            <th></th>
            <th></th>
            <th> 어웨이 </th>
            <th></th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="match, i : ${matchs}">
            <td th:text="${match.roundNo}"></td>
            <td th:text="${match.matchNo}"></td>
            <td th:text="${match.home == null} ? ${match.roundNo - 1} + '라운드 ' + ${match.matchNo * 2} + '경기 승자'
                : ${match.home.email + '('+ match.home.name + ')'}"></td>
            <td th:text="${match.score.homeScore}"></td>
            <td>:</td>
            <td th:text="${match.score.awayScore}"></td>
            <td th:text="${match.away == null} ? ${match.roundNo - 1} + '라운드' + ${match.matchNo * 2 + 1} + '경기 승자'
                : ${match.away.email + '('+ match.away.name + ')'}"></td>
            <td th:text="${match.matchStatus.description}"></td>
            <td>
                <input type="button" class="btn btn-primary" th:value="'수정'"
                       th:onclick="|location.href='/room/' + ${roomId} + '/competition/'+ ${competitionId} + '/match/update/' + ${match.id}|"
                       th:if="${match.home != null} and ${match.away != null} and ${myJoin != null} and ${myJoin.joinRole.name() != 'USER'}"/>
            </td>
        </tr>
        </tbody>
    </table>
    <div th:replace="fragments/footer" :: footer />
</div> &lt;!&ndash; /container &ndash;&gt;
</body>
</html>-->
