<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="fragments.html :: head"></head>
<body class="bg-light">
<div th:replace="fragments.html :: navigation-bar"></div>
<div class="container">
    <div th:replace="fragments.html :: competition-info"></div>
    <div class="row pt-3 justify-content-center">
        <div class="col-sm-10" th:object="${match}">
            <div th:replace="fragments.html :: message"></div>
            <div class="mb-3">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span th:if="${competition.isLeague()}" th:text="${match.round + 1} + '라운드 / ' + ${match.number + 1} + '경기'">경기 정보</span>
                        <span th:if="${competition.isTournament() and match.round == 0}" th:text="'결승'">경기 정보</span>
                        <span th:if="${competition.isTournament() and match.round == 1}" th:text="'준결승 / ' + ${match.number + 1} + '경기'">경기 정보</span>
                        <span th:if="${competition.isTournament() and match.round == 2}" th:text="'8강 / ' + ${match.number + 1} + '경기'">경기 정보</span>
                        <span th:if="${competition.isTournament() and match.round == 3}" th:text="'16강 / ' + ${match.number + 1} + '경기'">경기 정보</span>
                        <span th:if="${competition.isTournament() and match.round == 4}" th:text="'32강 / ' + ${match.number + 1} + '경기'">경기 정보</span>
                        <span th:if="${competition.isTournament() and match.round == 5}" th:text="'64강 / ' + ${match.number + 1} + '경기'">경기 정보</span>
                        <small th:if="${match.startDateTime == null}" class="text-warning">시간 미정</small>
                        <small th:if="${match.startDateTime != null}" class="date-time text-dark" th:text="${match.startDateTime}">경기 시간</small>
                    </div>
                    <div class="card-body text-center">
                        <div class="row">
                            <div class="col-4">
                                <svg th:if="${#strings.isEmpty(match.home?.image)}" th:data-jdenticon-value="${match.home?.name}" width="24" height="24" class="rounded-circle border bg-light me-3"></svg>
                                <img th:if="${!#strings.isEmpty(match.home?.image)}" th:src="${match.home?.image}" width="24" height="24" class="rounded-circle border me-3"/>
                                <span th:text="${match.home?.name}"></span>
                            </div>
                            <div class="col-4">
                                <span th:text="${match.status} ? ${match?.homeScore} : '-'">3</span>
                                <span th:if="${match?.homeScore != null and match?.awayScore != null}"> : </span>
                                <span th:text="${match.status} ? ${match?.awayScore} : '-'">2</span>
                            </div>
                            <div class="col-4">
                                <svg th:if="${#strings.isEmpty(match.away?.image)}" th:data-jdenticon-value="${match.away?.name}" width="24" height="24" class="rounded-circle border bg-light me-3"></svg>
                                <img th:if="${!#strings.isEmpty(match.away?.image)}" th:src="${match.away?.image}" width="24" height="24" class="rounded-circle border me-3"/>
                                <span th:text="${match.away?.name}"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row justify-content-center pt-3">
        <div class="col-sm-10">
            <div id="map" style="width: 100%; height: 600px;"></div>
        </div>
    </div>
    <div class="row pt-3 justify-content-center">
        <div class="col-sm-10 justify-content-center">
            <a sec:authorize="isAuthenticated()" th:if="${room.isAdmin(#authentication.principal)}" class="btn btn-outline-dark" th:href="@{|/rooms/${roomId}/competitions/${competitionId}/matches/${matchId}/update-location|}">
                경기 장소 수정
            </a>
            <a sec:authorize="isAuthenticated()" th:if="${room.isAdmin(#authentication.principal)}" class="btn btn-outline-dark" th:href="@{|/rooms/${roomId}/competitions/${competitionId}/matches/${matchId}/update-date|}">
                경기 시간 수정
            </a>
            <a sec:authorize="isAuthenticated()" th:if="${room.isAdmin(#authentication.principal)}" class="btn btn-outline-dark" th:href="@{|/rooms/${roomId}/competitions/${competitionId}/matches/${matchId}/update-score|}">
                경기 결과 수정
            </a>
            <a class="btn btn-outline-dark" th:href="@{|/rooms/${roomId}/competitions/${competitionId}|}">
                돌아가기
            </a>
        </div>
    </div>
    <div th:replace="fragments.html :: footer"></div>
</div> <!-- /container -->
<div th:replace="fragments.html :: date-time"></div>
<script type="text/javascript" th:inline="javascript">
    var longitude = [[${locationForm.longitude}]];
    var latitude = [[${locationForm.latitude}]];
    var jibunAddress = [[${locationForm.jibunAddress}]];
    var roadAddress = [[${locationForm.roadAddress}]];
    var current = new naver.maps.LatLng(latitude, longitude);
    var map = new naver.maps.Map("map", {
        center: current,
        zoom: 15,
        mapTypeControl: true
    });

    var infoWindow = new naver.maps.InfoWindow({
        anchorSkew: true
    });
    var htmlAddresses = [];
    var point = new naver.maps.Point(longitude, latitude);
    if (jibunAddress) {
        htmlAddresses.push('[지번 주소] ' + jibunAddress);
    }
    if (roadAddress) {
        htmlAddresses.push('[도로명 주소] ' + roadAddress);
    }
    htmlAddresses.push('[좌표] 위도 : ' + latitude + ', 경도 : ' + longitude);
    map.setCursor('pointer');
    infoWindow.setContent([
        '<div style="padding:10px;min-width:200px;line-height:150%;">',
        htmlAddresses.join('<br />'),
        '</div>'
    ].join('\n'));
    infoWindow.open(map, point);
</script>
</body>
</html>